-- ZeroKage„Çº„É≠ÂΩ± 2

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- Load Rayfield aman
local ok, Rayfield = pcall(function()
    return loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
end)
if not ok or not Rayfield then
    warn("Gagal load Rayfield GUI. Periksa koneksi atau URL Rayfield.")
    return
end

-------------------------------------------------
-- üîë Key Lokal & Expiry
-------------------------------------------------
local localKeys = {
    { key = "rafelll", expiry = "2025-11-25" },
}
local function parseExpiry(str)
    local y, m, d = str:match("^(%d+)%-(%d+)%-(%d+)$")
    if not y then return nil end
    return { year = tonumber(y), month = tonumber(m), day = tonumber(d) }
end
local function getLocalDate()
    local t = os.date("*t")
    return { year = t.year, month = t.month, day = t.day }
end
local function isExpired(expiry, now)
    if now.year > expiry.year then return true end
    if now.year < expiry.year then return false end
    if now.month > expiry.month then return true end
    if now.month < expiry.month then return false end
    if now.day > expiry.day then return true end
    return false
end
local function validateKey(inputKey, keyList, now)
    for _, entry in ipairs(keyList) do
        if entry.key == inputKey then
            local expiry = parseExpiry(entry.expiry)
            if not expiry then return false, "invalid_expiry" end
            if isExpired(expiry, now) then return false, "expired" end
            return true, expiry
        end
    end
    return false, "invalid"
end

-------------------------------------------------
-- üîë Key System
-------------------------------------------------
local keyVerified = false
local expiryDate = nil
local KeyWindow = nil

local function showKeyWindow()
    KeyWindow = Rayfield:CreateWindow({
        Name = "üï∏Ô∏è ZeroKage„Çº„É≠ÂΩ±",
        LoadingTitle = "ZeroKage Security",
        LoadingSubtitle = "Verifikasi Key Access"
    })

    local Tab = KeyWindow:CreateTab("Verifikasi", 4483362458)

    Tab:CreateInput({
        Name = "Masukkan Key",
        PlaceholderText = "Contoh: abcd",
        RemoveTextAfterFocusLost = false,
        Callback = function(input)
            Rayfield:Notify({
                Title = "üîç Memeriksa Key...",
                Content = "Harap tunggu...",
                Duration = 1.5
            })

            local now = getLocalDate()
            local valid, info = validateKey(input, localKeys, now)
            if valid then
                keyVerified = true
                expiryDate = info
                Rayfield:Notify({
                    Title = "‚úÖ Key Diterima",
                    Content = "Akses disetujui hingga " ..
                        string.format("%02d/%02d/%04d", info.day, info.month, info.year),
                    Duration = 4
                })

                KeyWindow.Visible = false
                task.wait(0.2)
                loadMainGUI()
            else
                if info == "expired" then
                    Rayfield:Notify({
                        Title = "‚è∞ Key Kadaluarsa",
                        Content = "Key sudah kadaluarsa.",
                        Duration = 4
                    })
                elseif info == "invalid_expiry" then
                    Rayfield:Notify({
                        Title = "‚ùå Format Expiry Salah",
                        Content = "Periksa format expiry pada key.",
                        Duration = 4
                    })
                else
                    Rayfield:Notify({
                        Title = "‚ùå Key Tidak Valid",
                        Content = "Periksa kembali key kamu.",
                        Duration = 3
                    })
                end
            end
        end
    })
end

-------------------------------------------------
-- ‚úàÔ∏è MAIN GUI (Fly + Teleport + Speed + Copy Pos + Jump + Auto Walk + Recording)
-------------------------------------------------
function loadMainGUI()
    if not keyVerified then return end

    local waypoints = {
        {name = "Mount Cicok", pos = Vector3.new(-161.89, 1598.15, -2141.80)},
        {name = "Mount Tatansutarma", pos = Vector3.new(-2234.73, 565.96, 1402.06)}
    }

    local flying = false
    local flySpeed = 60
    local walkSpeed = 16
    local jumpPower = 50
    local antiAFKEnabled = false
    local autoWalkActive = false

    local bodyGyro, bodyVel
    local flyConnection
    local antiAFKConnection

    local recordedSessions = {}
    local currentRecording = nil
    local playingBack = false
    local playbackConnection = nil

    local function getHRP()
        local c = player.Character
        if not c then return nil end
        return c:FindFirstChild("HumanoidRootPart")
    end

    local function teleportTo(pos)
        local hrp = getHRP()
        if hrp then
            hrp.CFrame = CFrame.new(pos + Vector3.new(0, 3, 0))
        else
            Rayfield:Notify({
                Title = "‚ö†Ô∏è Gagal Teleport",
                Content = "Character belum siap.",
                Duration = 2
            })
        end
    end

    local function startFly()
        local hrp = getHRP()
        if not hrp then
            Rayfield:Notify({
                Title = "‚ö†Ô∏è Gagal Fly",
                Content = "Character belum siap.",
                Duration = 2
            })
            return
        end
        flying = true
        bodyGyro = Instance.new("BodyGyro")
        bodyGyro.P = 9e4
        bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
        
        local cam = workspace.CurrentCamera
        local lookVector = cam.CFrame.LookVector
        lookVector = Vector3.new(lookVector.X, 0, lookVector.Z).Unit
        bodyGyro.CFrame = CFrame.new(hrp.Position, hrp.Position + lookVector)
        bodyGyro.Parent = hrp

        bodyVel = Instance.new("BodyVelocity")
        bodyVel.Velocity = Vector3.zero
        bodyVel.MaxForce = Vector3.new(9e9, 9e9, 9e9)
        bodyVel.Parent = hrp

        flyConnection = RunService.RenderStepped:Connect(function()
            if not flying or not hrp or not hrp.Parent then return end

            local cam = workspace.CurrentCamera
            local lookVector = cam.CFrame.LookVector
            lookVector = Vector3.new(lookVector.X, 0, lookVector.Z).Unit
            bodyGyro.CFrame = CFrame.new(hrp.Position, hrp.Position + lookVector)

            local moveDir = Vector3.zero
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then moveDir += lookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then moveDir -= lookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then moveDir -= cam.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then moveDir += cam.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then moveDir += Vector3.new(0, 1, 0) end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then moveDir -= Vector3.new(0, 1, 0) end

            local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
            if humanoid and humanoid.MoveDirection.Magnitude > 0 then
                moveDir = Vector3.new(humanoid.MoveDirection.X, 0, humanoid.MoveDirection.Z)
            end

            if moveDir.Magnitude > 0 then
                bodyVel.Velocity = moveDir.Unit * flySpeed
            else
                bodyVel.Velocity = Vector3.zero
            end
        end)
    end

    local function stopFly()
        flying = false
        if bodyGyro then bodyGyro:Destroy() bodyGyro = nil end
        if bodyVel then bodyVel:Destroy() bodyVel = nil end
        if flyConnection then flyConnection:Disconnect() flyConnection = nil end
    end

    -- Auto Walk logic tiap frame
    RunService.RenderStepped:Connect(function()
        if autoWalkActive then
            local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
            if hum then
                local direction = workspace.CurrentCamera.CFrame.LookVector
                direction = Vector3.new(direction.X, 0, direction.Z).Unit
                hum:Move(direction, false)
            end
        end

        if currentRecording then
            local char = player.Character
            if char and char.PrimaryPart then
                table.insert(currentRecording, char.PrimaryPart.Position)
            end
        end
    end)

    local Window = Rayfield:CreateWindow({
        Name = "ZeroKage„Çº„É≠ÂΩ±",
        LoadingTitle = "ZeroKage Menu",
        LoadingSubtitle = "Key Aktif hingga " ..
            string.format("%02d/%02d/%04d", expiryDate.day, expiryDate.month, expiryDate.year)
    })

    local TabTeleport = Window:CreateTab("Teleport", 4483362458)
    for _, wp in ipairs(waypoints) do
        TabTeleport:CreateButton({
            Name = "üåç Teleport ke: " .. wp.name,
            Callback = function() teleportTo(wp.pos) end
        })
    end

    local TabFitur = Window:CreateTab("Fitur", 4483362458)

    local selectedRecordingIndex = nil
    local recordingDropdown

    local function updateDropdown()
        local list = {}
        for i, rec in ipairs(recordedSessions) do
            table.insert(list, "Rekaman ke-" .. i .. " (" .. #rec .. " posisi)")
        end
        if recordingDropdown then
            recordingDropdown:UpdateOptions(list)
            recordingDropdown:Set(nil)
        end
        return list
    end

    TabFitur:CreateToggle({
        Name = "üö∂ Auto Walk (ON/OFF)",
        CurrentValue = false,
        Callback = function(state)
            autoWalkActive = state
            Rayfield:Notify({
                Title = "üö∂ Auto Walk",
                Content = state and "Aktif" or "Nonaktif",
                Duration = 3
            })
        end,
    })

    TabFitur:CreateButton({
        Name = "‚è∫Ô∏è Mulai Rekam",
        Callback = function()
            if currentRecording then
                Rayfield:Notify({Title="‚ö†Ô∏è", Content="Rekaman sedang berlangsung!", Duration=2})
                return
            end
            currentRecording = {}
            Rayfield:Notify({Title="‚è∫Ô∏è Rekaman Dimulai", Content="Mulai merekam posisi...", Duration=3})
        end,
    })

    TabFitur:CreateButton({
        Name = "‚èπÔ∏è Berhenti Rekam",
        Callback = function()
            if not currentRecording then
                Rayfield:Notify({Title="‚ö†Ô∏è", Content="Belum ada rekaman yang berjalan!", Duration=2})
                return
            end
            table.insert(recordedSessions, currentRecording)
            currentRecording = nil
            Rayfield:Notify({Title="‚èπÔ∏è Rekaman Berhenti", Content="Rekaman disimpan ke daftar.", Duration=3})
            updateDropdown()
        end,
    })

    recordingDropdown = TabFitur:CreateDropdown({
        Name = "üìÇ Pilih Rekaman",
        Options = updateDropdown(),
        CurrentOption = nil,
        MultiSelect = false,
        Callback = function(option)
            selectedRecordingIndex = nil
            for i, recName in ipairs(updateDropdown()) do
                if recName == option then
                    selectedRecordingIndex = i
                    break
                end
            end
        end,
    })

    TabFitur:CreateButton({
        Name = "üóëÔ∏è Hapus Rekaman Terpilih",
        Callback = function()
            if not selectedRecordingIndex or not recordedSessions[selectedRecordingIndex] then
                Rayfield:Notify({Title="‚ö†Ô∏è", Content="Pilih rekaman terlebih dahulu.", Duration=2})
                return
            end
            table.remove(recordedSessions, selectedRecordingIndex)
            selectedRecordingIndex = nil
            updateDropdown()
            Rayfield:Notify({Title="üóëÔ∏è Berhasil Dihapus", Content="Rekaman telah dihapus.", Duration=3})
        end,
    })

    TabFitur:CreateButton({
        Name = "üíæ Simpan Semua Rekaman (Simulasi)",
        Callback = function()
            if #recordedSessions == 0 then
                Rayfield:Notify({Title="‚ö†Ô∏è", Content="Tidak ada rekaman untuk disimpan.", Duration=2})
                return
            end
            Rayfield:Notify({Title="üíæ Rekaman Disimpan", Content=#recordedSessions .. " rekaman disimpan (simulasi).", Duration=3})
        end,
    })

    TabFitur:CreateButton({
        Name = "‚ñ∂Ô∏è Putar Rekaman Terpilih",
        Callback = function()
            if playingBack then
                Rayfield:Notify({Title="‚ö†Ô∏è", Content="Sedang memutar rekaman lain!", Duration=2})
                return
            end
            if not selectedRecordingIndex or not recordedSessions[selectedRecordingIndex] then
                Rayfield:Notify({Title="‚ö†Ô∏è", Content="Pilih rekaman terlebih dahulu.", Duration=2})
                return
            end
            local playData = {}
            for _, pos in ipairs(recordedSessions[selectedRecordingIndex]) do
                table.insert(playData, pos)
            end
            local char = player.Character
            if not char or not char.PrimaryPart then
                Rayfield:Notify({Title="‚ö†Ô∏è", Content="Character belum siap.", Duration=2})
                return
            end
            playingBack = true
            Rayfield:Notify({Title="‚ñ∂Ô∏è Memulai Playback", Content="Mulai memutar rekaman...", Duration=2})
            playbackConnection = RunService.RenderStepped:Connect(function()
                if #playData == 0 then
                    playbackConnection:Disconnect()
                    playbackConnection = nil
                    playingBack = false
                    Rayfield:Notify({Title="‚ñ∂Ô∏è Playback Selesai", Content="Pemutaran rekaman selesai.", Duration=3})
                    return
                end
                local pos = table.remove(playData, 1)
                if char and char.PrimaryPart then
                    char:SetPrimaryPartCFrame(CFrame.new(pos))
                end
            end)
        end,
    })

    TabFitur:CreateButton({
        Name = "‚èπÔ∏è Hentikan Playback",
        Callback = function()
            if playbackConnection then
                playbackConnection:Disconnect()
                playbackConnection = nil
                playingBack = false
                Rayfield:Notify({Title="‚èπÔ∏è Playback Dihentikan", Content="Pemutaran rekaman dihentikan.", Duration=3})
            else
                Rayfield:Notify({Title="‚ö†Ô∏è", Content="Tidak ada playback yang berjalan.", Duration=2})
            end
        end,
    })

    -- Speed & Jump Tabs (sesuai kode Anda, tidak berubah)

    player.CharacterAdded:Connect(function(char)
        local hum = char:WaitForChild("Humanoid")
        hum.WalkSpeed = walkSpeed
        hum.JumpPower = jumpPower
    end)
end

showKeyWindow()
