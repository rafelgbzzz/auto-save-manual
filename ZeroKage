-- ZeroKage„Çº„É≠ÂΩ±

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local DataStoreService = game:GetService("DataStoreService")
local dataStore = DataStoreService:GetDataStore("AutoWalkPaths")

-- Load Rayfield aman
local ok, Rayfield = pcall(function()
    return loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
end)
if not ok or not Rayfield then
    warn("Gagal load Rayfield GUI. Periksa koneksi atau URL Rayfield.")
    return
end

-------------------------------------------------
-- üîë Key Lokal & Expiry
-------------------------------------------------
local localKeys = {
    { key = "rafelll", expiry = "2025-11-25" },
}

local function parseExpiry(str)
    local y, m, d = str:match("^(%d+)%-(%d+)%-(%d+)$")
    if not y then return nil end
    return { year = tonumber(y), month = tonumber(m), day = tonumber(d) }
end

local function getLocalDate()
    local t = os.date("*t")
    return { year = t.year, month = t.month, day = t.day }
end

local function isExpired(expiry, now)
    if now.year > expiry.year then return true end
    if now.year < expiry.year then return false end
    if now.month > expiry.month then return true end
    if now.month < expiry.month then return false end
    if now.day > expiry.day then return true end
    return false
end

local function validateKey(inputKey, keyList, now)
    for _, entry in ipairs(keyList) do
        if entry.key == inputKey then
            local expiry = parseExpiry(entry.expiry)
            if not expiry then return false, "invalid_expiry" end
            if isExpired(expiry, now) then return false, "expired" end
            return true, expiry
        end
    end
    return false, "invalid"
end

-------------------------------------------------
-- üîë Key System
-------------------------------------------------
local keyVerified = false
local expiryDate = nil
local KeyWindow = nil

local function showKeyWindow()
    KeyWindow = Rayfield:CreateWindow({
        Name = "üï∏Ô∏è ZeroKage„Çº„É≠ÂΩ±",
        LoadingTitle = "ZeroKage Security",
        LoadingSubtitle = "Verifikasi Key Access"
    })

    local Tab = KeyWindow:CreateTab("Verifikasi", 4483362458)

    Tab:CreateInput({
        Name = "Masukkan Key",
        PlaceholderText = "Contoh: abcd",
        RemoveTextAfterFocusLost = false,
        Callback = function(input)
            Rayfield:Notify({
                Title = "üîç Memeriksa Key...",
                Content = "Harap tunggu...",
                Duration = 1.5
            })

            local now = getLocalDate()
            local valid, info = validateKey(input, localKeys, now)
            if valid then
                keyVerified = true
                expiryDate = info
                Rayfield:Notify({
                    Title = "‚úÖ Key Diterima",
                    Content = "Akses disetujui hingga " ..
                        string.format("%02d/%02d/%04d", info.day, info.month, info.year),
                    Duration = 4
                })

                KeyWindow.Visible = false
                task.wait(0.2)
                loadMainGUI()
            else
                if info == "expired" then
                    Rayfield:Notify({
                        Title = "‚è∞ Key Kadaluarsa",
                        Content = "Key sudah kadaluarsa.",
                        Duration = 4
                    })
                elseif info == "invalid_expiry" then
                    Rayfield:Notify({
                        Title = "‚ùå Format Expiry Salah",
                        Content = "Periksa format expiry pada key.",
                        Duration = 4
                    })
                else
                    Rayfield:Notify({
                        Title = "‚ùå Key Tidak Valid",
                        Content = "Periksa kembali key kamu.",
                        Duration = 3
                    })
                end
            end
        end
    })
end

-------------------------------------------------
-- ‚úàÔ∏è MAIN GUI (Fly + Teleport + Speed + Copy Pos + Jump + Auto-Walk)
-------------------------------------------------
function loadMainGUI()
    if not keyVerified then return end

    local waypoints = {
        {name = "Mount Cicok", pos = Vector3.new(-161.89, 1598.15, -2141.80)},
        {name = "Mount Tatansutarma", pos = Vector3.new(-2234.73, 565.96, 1402.06)}
    }

    local flying = false
    local flySpeed = 60
    local walkSpeed = 16
    local jumpPower = 50
    local antiAFKEnabled = false
    local bodyGyro, bodyVel
    local flyConnection
    local antiAFKConnection

    -- Auto-Walk Data
    local AutoWalkData = {path = {}, names = {}}

    local function getHRP()
        local c = player.Character
        if not c then return nil end
        return c:FindFirstChild("HumanoidRootPart")
    end

    local function teleportTo(pos)
        local hrp = getHRP()
        if hrp then
            hrp.CFrame = CFrame.new(pos + Vector3.new(0, 3, 0))
        else
            Rayfield:Notify({
                Title = "‚ö†Ô∏è Gagal Teleport",
                Content = "Character belum siap.",
                Duration = 2
            })
        end
    end

    -- ‚úàÔ∏è Fly System
    local function startFly()
        local hrp = getHRP()
        if not hrp then
            Rayfield:Notify({Title = "‚ö†Ô∏è Gagal Fly", Content = "Character belum siap.", Duration = 2})
            return
        end
        flying = true
        bodyGyro = Instance.new("BodyGyro")
        bodyGyro.P = 9e4
        bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
        local cam = workspace.CurrentCamera
        local lookVector = cam.CFrame.LookVector
        lookVector = Vector3.new(lookVector.X,0,lookVector.Z).Unit
        bodyGyro.CFrame = CFrame.new(hrp.Position, hrp.Position + lookVector)
        bodyGyro.Parent = hrp

        bodyVel = Instance.new("BodyVelocity")
        bodyVel.Velocity = Vector3.zero
        bodyVel.MaxForce = Vector3.new(9e9,9e9,9e9)
        bodyVel.Parent = hrp

        flyConnection = RunService.RenderStepped:Connect(function()
            if not flying or not hrp or not hrp.Parent then return end
            local cam = workspace.CurrentCamera
            local lookVector = Vector3.new(cam.CFrame.LookVector.X,0,cam.CFrame.LookVector.Z).Unit
            bodyGyro.CFrame = CFrame.new(hrp.Position, hrp.Position + lookVector)

            local moveDir = Vector3.zero
            -- PC
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then moveDir += lookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then moveDir -= lookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then moveDir -= cam.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then moveDir += cam.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then moveDir += Vector3.new(0,1,0) end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then moveDir -= Vector3.new(0,1,0) end
            -- Mobile
            local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
            if humanoid and humanoid.MoveDirection.Magnitude > 0 then
                moveDir = Vector3.new(humanoid.MoveDirection.X,0,humanoid.MoveDirection.Z)
            end
            bodyVel.Velocity = (moveDir.Magnitude>0 and moveDir.Unit*flySpeed) or Vector3.zero
        end)
    end

    local function stopFly()
        flying = false
        if bodyGyro then bodyGyro:Destroy(); bodyGyro=nil end
        if bodyVel then bodyVel:Destroy(); bodyVel=nil end
        if flyConnection then flyConnection:Disconnect(); flyConnection=nil end
    end

    -- GUI Utama
    local Window = Rayfield:CreateWindow({
        Name = "ZeroKage„Çº„É≠ÂΩ±",
        LoadingTitle = "ZeroKage Menu",
        LoadingSubtitle = "Key Aktif hingga " ..
            string.format("%02d/%02d/%04d", expiryDate.day, expiryDate.month, expiryDate.year)
    })

    -- üåç TAB TELEPORT
    local TabTeleport = Window:CreateTab("Teleport", 4483362458)
    for _, wp in ipairs(waypoints) do
        TabTeleport:CreateButton({Name = "üåç Teleport ke: "..wp.name, Callback = function() teleportTo(wp.pos) end})
    end

    -- ‚öôÔ∏è TAB FITUR
    local TabFitur = Window:CreateTab("Fitur", 4483362458)
    TabFitur:CreateButton({Name = "üíæ Copy Koordinat Sekarang", Callback = function()
        local hrp = getHRP()
        if not hrp then
            Rayfield:Notify({Title="‚ö†Ô∏è Gagal", Content="Character belum siap.", Duration=2})
            return
        end
        setclipboard(string.format("Vector3.new(%.2f,%.2f,%.2f)", hrp.Position.X, hrp.Position.Y, hrp.Position.Z))
        Rayfield:Notify({Title="‚úÖ Koordinat Disalin", Content="Disalin ke clipboard.", Duration=3})
    end})
    TabFitur:CreateToggle({Name="üõ°Ô∏è Anti AFK (ON/OFF)", CurrentValue=false, Callback=function(value)
        antiAFKEnabled=value
        if value then
            if antiAFKConnection then antiAFKConnection:Disconnect() end
            antiAFKConnection=player.Idled:Connect(function()
                local VirtualUser=game:service('VirtualUser')
                VirtualUser:CaptureController()
                VirtualUser:ClickButton2(Vector2.new())
            end)
            Rayfield:Notify({Title="üõ°Ô∏è Anti AFK Aktif", Content="Kamu aman dari kick AFK!", Duration=4})
        else
            if antiAFKConnection then antiAFKConnection:Disconnect(); antiAFKConnection=nil end
            Rayfield:Notify({Title="üí§ Anti AFK Nonaktif", Content="AFK protection dimatikan.", Duration=3})
        end
    end})

    -------------------------------------------------
    -- ‚ö° TAB KECEPATAN
    -------------------------------------------------
    local TabSpeed = Window:CreateTab("Kecepatan", 4483362458)
    TabSpeed:CreateToggle({Name="üïäÔ∏è Mode Fly", CurrentValue=false, Callback=function(state)
        if state then startFly(); Rayfield:Notify({Title="‚úàÔ∏è Fly Aktif", Content="Gunakan W A S D / Joystick untuk bergerak.", Duration=3})
        else stopFly(); Rayfield:Notify({Title="üõë Fly Dimatikan", Content="Mode fly berhenti.", Duration=2}) end
    end})
    TabSpeed:CreateSlider({Name="‚ö° Kecepatan Fly", Range={10,200}, Increment=5, Suffix="Speed", CurrentValue=flySpeed, Callback=function(v) flySpeed=v end})
    local SpeedSlider = TabSpeed:CreateSlider({Name="üèÉ Kecepatan Lari", Range={16,200}, Increment=1, Suffix="Speed", CurrentValue=walkSpeed, Callback=function(v)
        local hum=player.Character and player.Character:FindFirstChildOfClass("Humanoid")
        if hum then hum.WalkSpeed=v; walkSpeed=v end
    end})
    local JumpSlider = TabSpeed:CreateSlider({Name="ü¶ò Kekuatan Lompatan", Range={50,500}, Increment=10, Suffix="Power", CurrentValue=jumpPower, Callback=function(v)
        local hum=player.Character and player.Character:FindFirstChildOfClass("Humanoid")
        if hum then hum.UseJumpPower=true; hum.JumpPower=v; jumpPower=v end
    end})
    TabSpeed:CreateButton({Name="‚Ü©Ô∏è Reset Kecepatan & Lompatan (Normal)", Callback=function()
        local hum=player.Character and player.Character:FindFirstChildOfClass("Humanoid")
        if hum then hum.WalkSpeed=16; hum.JumpPower=50 end
        SpeedSlider:Set(16)
        JumpSlider:Set(50)
        Rayfield:Notify({Title="Reset Berhasil", Content="WalkSpeed & JumpPower dikembalikan ke normal.", Duration=3})
    end})

    -- Jaga nilai tetap sama pas respawn
    player.CharacterAdded:Connect(function(char)
        local hum=char:WaitForChild("Humanoid")
        hum.WalkSpeed=walkSpeed
        hum.JumpPower=jumpPower
    end)

    -------------------------------------------------
    -- üíæ TAB AUTO-WALK (Record / Play / Save / Load)
    -------------------------------------------------
    local TabAutoWalk = Window:CreateTab("Auto-Walk", 4483362458)

    -- Record Posisi Sekarang
    TabAutoWalk:CreateButton({Name="üìå Record Posisi Sekarang", Callback=function()
        local hrp=getHRP()
        if not hrp then Rayfield:Notify({Title="‚ö†Ô∏è Gagal Record", Content="Character belum siap.", Duration=2}); return end
        local segmentName
        if #AutoWalkData.names==0 then segmentName="BaseCamp ‚Üí CP1"
        else local last=AutoWalkData.names[#AutoWalkData.names]; local idx=tonumber(last:match("CP(%d+)")) or #AutoWalkData.names; segmentName=string.format("CP%d ‚Üí CP%d", idx, idx+1) end
        table.insert(AutoWalkData.path, hrp.Position)
        table.insert(AutoWalkData.names, segmentName)
        Rayfield:Notify({Title="üìå Posisi Direkam", Content=segmentName.." disimpan.", Duration=3})
    end})

    -- Delete Segment Terakhir
    TabAutoWalk:CreateButton({Name="üóëÔ∏è Delete Segment Terakhir", Callback=function()
        if #AutoWalkData.path>0 then
            local deletedName=table.remove(AutoWalkData.names)
            table.remove(AutoWalkData.path)
            Rayfield:Notify({Title="üóëÔ∏è Segment Dihapus", Content=deletedName.." telah dihapus.", Duration=3})
        else
            Rayfield:Notify({Title="‚ö†Ô∏è Kosong", Content="Tidak ada segment untuk dihapus.", Duration=2})
        end
    end})

    -- Save Permanen ke DataStore
    TabAutoWalk:CreateButton({Name="üíæ Save Path Permanen", Callback=function()
        local success, err=pcall(function()
            dataStore:SetAsync(player.UserId,{path=AutoWalkData.path, names=AutoWalkData.names})
        end)
        if success then
            Rayfield:Notify({Title="üíæ Berhasil Disimpan", Content="Path tersimpan permanen di server Roblox.", Duration=3})
        else
            Rayfield:Notify({Title="‚ö†Ô∏è Gagal Simpan", Content=err or "Terjadi error saat menyimpan.", Duration=3})
        end
    end})

    -- Load Path dari DataStore
    TabAutoWalk:CreateButton({Name="üìÇ Load Path", Callback=function()
        local success, data = pcall(function()
            return dataStore:GetAsync(player.UserId)
        end)
        if success and data then
            AutoWalkData.path = data.path or {}
            AutoWalkData.names = data.names or {}
            Rayfield:Notify({Title="üìÇ Path Dimuat", Content=#AutoWalkData.path.." segment berhasil dimuat.", Duration=3})
        else
            Rayfield:Notify({Title="‚ö†Ô∏è Gagal Load", Content="Path tidak ditemukan atau error.", Duration=3})
        end
    end})

    -- Play Path Auto-Walk
    TabAutoWalk:CreateButton({Name="‚ñ∂Ô∏è Play Auto-Walk", Callback=function()
        local hrp=getHRP()
        if not hrp then Rayfield:Notify({Title="‚ö†Ô∏è Gagal Play", Content="Character belum siap.", Duration=2}); return end
        if #AutoWalkData.path==0 then Rayfield:Notify({Title="‚ö†Ô∏è Kosong", Content="Belum ada path yang direkam.", Duration=2}); return end
        Rayfield:Notify({Title="‚ñ∂Ô∏è Auto-Walk Dimulai", Content="Ikuti path yang direkam.", Duration=2})
        spawn(function()
            for i,pos in ipairs(AutoWalkData.path) do
                local startPos = hrp.Position
                local targetPos = pos
                local distance = (targetPos - startPos).Magnitude
                local speed = 60
                local travelTime = distance / speed
                local elapsed = 0
                while elapsed < travelTime do
                    local dt = RunService.RenderStepped:Wait()
                    elapsed = elapsed + dt
                    local alpha = math.clamp(elapsed / travelTime,0,1)
                    hrp.CFrame = CFrame.new(startPos:Lerp(targetPos,alpha))
                end
                hrp.CFrame = CFrame.new(targetPos)
                Rayfield:Notify({Title="üìç Sampai Segment", Content=AutoWalkData.names[i], Duration=1.5})
            end
        end)
    end})
end

-- üîë Tampilkan GUI Key
showKeyWindow()
