local Players = game:GetService("Players")
local player = Players.LocalPlayer
local RunService = game:GetService("RunService")

local ok, Rayfield = pcall(function()
    return loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
end)
if not ok or not Rayfield then
    warn("Gagal load Rayfield GUI.")
    return
end

local recordedSessions = {}
local currentRecording = nil
local playingBack = false
local playbackConnection = nil

local Window = Rayfield:CreateWindow({
    Name = "Recording Controller",
    LoadingTitle = "Recording",
    LoadingSubtitle = "Simple record/playback system"
})

local Tab = Window:CreateTab("Recording", 4483362458)

local displayFrame = Instance.new("Frame")
displayFrame.Size = UDim2.new(1, 0, 0, 200)
displayFrame.BackgroundTransparency = 1

local UIListLayout = Instance.new("UIListLayout", displayFrame)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

Tab:AddCustomElement(displayFrame)

local function refreshRecordingList()
    for _, child in pairs(displayFrame:GetChildren()) do
        if child:IsA("TextLabel") then
            child:Destroy()
        end
    end

    for i, rec in ipairs(recordedSessions) do
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(1, 0, 0, 30)
        label.BackgroundTransparency = 0.5
        label.BackgroundColor3 = Color3.new(0, 0, 0)
        label.TextColor3 = Color3.new(1,1,1)
        label.Text = string.format("Rekaman ke-%d: %d posisi", i, #rec)
        label.LayoutOrder = i
        label.Parent = displayFrame
    end
end

Tab:CreateButton({
    Name = "‚è∫Ô∏è Start Recording",
    Callback = function()
        if currentRecording then
            Rayfield:Notify({Title = "‚ö†Ô∏è Error", Content = "Recording already in progress", Duration = 3})
            return
        end
        currentRecording = {}
        Rayfield:Notify({Title = "Recording started", Duration = 3})
    end,
})

Tab:CreateButton({
    Name = "‚èπÔ∏è Stop Recording",
    Callback = function()
        if not currentRecording then
            Rayfield:Notify({Title = "‚ö†Ô∏è Error", Content = "No recording in progress", Duration = 3})
            return
        end
        table.insert(recordedSessions, currentRecording)
        currentRecording = nil
        refreshRecordingList()
        Rayfield:Notify({Title = "Recording stopped", Duration = 3})
    end,
})

local selectedIndex = nil

Tab:CreateButton({
    Name = "üíæ Save Last Recording (simulated)",
    Callback = function()
        if #recordedSessions == 0 then
            Rayfield:Notify({Title = "‚ö†Ô∏è Error", Content = "No recordings to save", Duration = 3})
            return
        end
        Rayfield:Notify({Title = "Saved", Content = "Simulated saving of last recording", Duration = 3})
    end,
})

Tab:CreateButton({
    Name = "‚ñ∂Ô∏è Play Last Recording",
    Callback = function()
        if playingBack then
            Rayfield:Notify({Title = "‚ö†Ô∏è Error", Content = "Already playing back", Duration = 3})
            return
        end
        if #recordedSessions == 0 then
            Rayfield:Notify({Title = "‚ö†Ô∏è Error", Content = "No recordings to play", Duration = 3})
            return
        end
        local char = player.Character
        if not char or not char.PrimaryPart then
            Rayfield:Notify({Title = "‚ö†Ô∏è Error", Content = "Character not ready", Duration = 3})
            return
        end
        playingBack = true
        local playbackData = {}
        for _, pos in ipairs(recordedSessions[#recordedSessions]) do
            table.insert(playbackData, pos)
        end
        Rayfield:Notify({Title = "Playback started", Duration = 3})

        playbackConnection = RunService.RenderStepped:Connect(function()
            if #playbackData == 0 then
                playbackConnection:Disconnect()
                playingBack = false
                Rayfield:Notify({Title = "Playback complete", Duration = 3})
                return
            end
            local pos = table.remove(playbackData, 1)
            char:SetPrimaryPartCFrame(CFrame.new(pos))
        end)
    end,
})

Tab:CreateButton({
    Name = "‚èπÔ∏è Stop Playback",
    Callback = function()
        if playingBack and playbackConnection then
            playbackConnection:Disconnect()
            playingBack = false
            Rayfield:Notify({Title = "Playback stopped", Duration = 3})
        else
            Rayfield:Notify({Title = "‚ö†Ô∏è Error", Content = "No playback active", Duration = 3})
        end
    end,
})

-- Record position each frame while recording
RunService.RenderStepped:Connect(function()
    if currentRecording then
        local char = player.Character
        if char and char.PrimaryPart then
            table.insert(currentRecording, char.PrimaryPart.Position)
        end
    end
end)
