-- RAFEEYL Auto Teleport (Waypoint Permanen + Save + Copy + Auto Respawn)
-- versi gabungan fix save posisi real-time üíæ

local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local HttpService = game:GetService("HttpService")

-- üëá Masukkan waypoint hasil salin clipboard ke sini (nama + posisi)
local waypoints = {
    {name = "Gunung Cicok", pos = Vector3.new(123.45, 67.89, 101.23)},
    {name = "Puncak Lava", pos = Vector3.new(150.12, 80.77, 90.55)},
    {name = "Summit Salju", pos = Vector3.new(180.77, 92.15, 75.32)}
}

-- üß© Setting awal
local running = false
local autoRespawn = true
local delaySeconds = 5
local loopCoroutine
local respawnLoop

-- Helper
local function getHRP()
    local c = player.Character
    if not c then return nil end
    return c:FindFirstChild("HumanoidRootPart")
end

local function teleportTo(pos)
    local hrp = getHRP()
    if hrp then
        hrp.CFrame = CFrame.new(pos + Vector3.new(0, 3, 0))
    end
end

-- üîÅ Auto respawn loop (langsung respawn tanpa nunggu mati)
local function startAutoRespawn()
    if respawnLoop then return end
    respawnLoop = coroutine.create(function()
        while autoRespawn do
            player:LoadCharacter()
            Rayfield:Notify({
                Title = "Auto Respawn",
                Content = "Respawn otomatis dilakukan.",
                Duration = 1.5
            })
            task.wait(delaySeconds)
        end
    end)
    coroutine.resume(respawnLoop)
end

local function stopAutoRespawn()
    autoRespawn = false
    respawnLoop = nil
end

local function startLoop()
    if running or #waypoints == 0 then
        warn("[RAFEEYL] Tidak ada waypoint permanen!")
        return
    end
    running = true

    if autoRespawn then
        startAutoRespawn()
    end

    loopCoroutine = coroutine.create(function()
        local idx = 1
        while running do
            local wp = waypoints[idx]
            teleportTo(wp.pos)
            Rayfield:Notify({
                Title = "Teleporting...",
                Content = "Menuju lokasi: " .. wp.name,
                Duration = 2
            })
            idx += 1
            if idx > #waypoints then idx = 1 end
            task.wait(delaySeconds)
        end
    end)
    coroutine.resume(loopCoroutine)
end

-- GUI
local Window = Rayfield:CreateWindow({
    Name = "RAFEEYL - Auto Teleport",
    LoadingTitle = "RAFEEYL",
    LoadingSubtitle = "Permanent Summit Version"
})

local Tab = Window:CreateTab("Teleport", 4483362458)

-- üéØ SAVE POSISI SEKARANG (versi fix kamu)
Tab:CreateButton({
    Name = "üíæ Save Posisi (Copy ke Clipboard)",
    Callback = function()
        local character = player.Character or player.CharacterAdded:Wait()
        local hrp = character:WaitForChild("HumanoidRootPart", 2)
        if not hrp then
            Rayfield:Notify({
                Title = "Gagal",
                Content = "Tidak dapat menemukan posisi karakter!",
                Duration = 2
            })
            return
        end

        -- ambil posisi real-time
        local pos = hrp.Position
        local text = string.format("Vector3.new(%.2f, %.2f, %.2f)", pos.X, pos.Y, pos.Z)
        if setclipboard then
            setclipboard(text)
            Rayfield:Notify({
                Title = "Posisi Disalin!",
                Content = "Koordinat berhasil disalin ke clipboard:\n" .. text,
                Duration = 4
            })
        else
            Rayfield:Notify({
                Title = "Clipboard Tidak Didukung",
                Content = "Executor kamu tidak mendukung setclipboard!",
                Duration = 3
            })
        end
    end
})

-- ‚ñ∂Ô∏è START AUTO TELEPORT
Tab:CreateButton({
    Name = "‚ñ∂Ô∏è Start Auto Teleport",
    Callback = function()
        running = true
        autoRespawn = true
        startLoop()
        Rayfield:Notify({
            Title = "Started",
            Content = "Auto Teleport + Auto Respawn aktif.",
            Duration = 2
        })
    end
})

-- ‚èπ STOP SEMUA
Tab:CreateButton({
    Name = "‚èπ Stop Semua",
    Callback = function()
        running = false
        stopAutoRespawn()
        Rayfield:Notify({
            Title = "Stopped",
            Content = "Auto Teleport & Respawn dihentikan.",
            Duration = 2
        })
    end
})

-- üîò TELEPORT MANUAL
for i, wp in ipairs(waypoints) do
    Tab:CreateButton({
        Name = "üåç Teleport ke: " .. wp.name,
        Callback = function()
            teleportTo(wp.pos)
            Rayfield:Notify({
                Title = "Teleport Manual",
                Content = "Berhasil teleport ke: " .. wp.name,
                Duration = 2
            })
        end
    })
end
