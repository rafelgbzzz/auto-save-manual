-- RAFEEYL Auto Teleport (Remote Key GitHub + Server Time + Fly + Teleport)
-- Aman dari ubah tanggal lokal, langsung ambil waktu UTC dari GitHub

local HttpService = game:GetService("HttpService")
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-------------------------------------------------
-- üåê GANTI BAGIAN INI SESUAI GITHUB KAMU
-------------------------------------------------
local githubKeyUrl = "https://raw.githubusercontent.com/rafelgbzzz/auto-save-manual/main/keys.json"
local githubTimeUrl = "https://raw.githubusercontent.com/rafelgbzzz/auto-save-manual/refs/heads/main/utcdate.json"
-------------------------------------------------

-- üïí Ambil waktu UTC dari GitHub
local function getServerDate()
	local ok, result = pcall(function()
		return game:HttpGet(githubTimeUrl, true)
	end)
	if not ok then return nil end

	local data = HttpService:JSONDecode(result)
	if not data or not data.utc_date then return nil end

	local y, m, d = data.utc_date:match("^(%d+)%-(%d+)%-(%d+)$")
	return {year = tonumber(y), month = tonumber(m), day = tonumber(d)}
end

-- üîë Ambil daftar key dari GitHub
local function getKeysFromGitHub()
	local ok, result = pcall(function()
		return game:HttpGet(githubKeyUrl, true)
	end)
	if not ok then return nil end

	local data = HttpService:JSONDecode(result)
	return data
end

-- ‚è∞ Cek apakah tanggal expired
local function isExpired(expiry, now)
	local y, m, d = expiry.year, expiry.month, expiry.day
	if now.year > y then return true end
	if now.year == y and now.month > m then return true end
	if now.year == y and now.month == m and now.day > d then return false end
	return false
end

-- üîç Validasi key
local function validateKey(inputKey, keyList, now)
	for _, entry in ipairs(keyList) do
		if entry.key == inputKey then
			local y, m, d = entry.expiry:match("^(%d+)%-(%d+)%-(%d+)$")
			local expiry = {year = tonumber(y), month = tonumber(m), day = tonumber(d)}
			if isExpired(expiry, now) then
				return false, "expired"
			else
				return true, expiry
			end
		end
	end
	return false, "invalid"
end

-------------------------------------------------
-- üîë SYSTEM LOGIN (Key Input) REVISI
-------------------------------------------------
local keyVerified = false
local expiryDate = nil

local KeyWindow = Rayfield:CreateWindow({
	Name = "üîë RAFEEYL Key System",
	LoadingTitle = "RAFEEYL Security",
	LoadingSubtitle = "Verifikasi key dari server"
})

local Tab = KeyWindow:CreateTab("Verifikasi", 4483362458)

Tab:CreateInput({
	Name = "Masukkan Key",
	PlaceholderText = "Contoh: RAFEEYL-ACCESS-123",
	RemoveTextAfterFocusLost = false,
	Callback = function(input)
		Rayfield:Notify({
			Title = "üîç Memeriksa Key...",
			Content = "Harap tunggu, sedang memverifikasi...",
			Duration = 2
		})

		local serverNow = getServerDate()
		if not serverNow then
			Rayfield:Notify({
				Title = "‚ö†Ô∏è Gagal Ambil Waktu",
				Content = "Tidak dapat mengakses server waktu GitHub. Periksa koneksi kamu.",
				Duration = 4
			})
			return
		end

		local keyList = getKeysFromGitHub()
		if not keyList then
			Rayfield:Notify({
				Title = "‚ö†Ô∏è Gagal Ambil Key",
				Content = "Tidak dapat mengambil data key dari GitHub.",
				Duration = 4
			})
			return
		end

		local valid, info = validateKey(input, keyList, serverNow)
		if valid then
			keyVerified = true
			expiryDate = info

			Rayfield:Notify({
				Title = "‚úÖ Key Diterima",
				Content = "Akses disetujui hingga " .. string.format("%02d/%02d/%04d", info.day, info.month, info.year),
				Duration = 5
			})

			task.wait(0.1)
			KeyWindow:Destroy()

			print("Key verified:", keyVerified)
			print("Expiry date:", expiryDate.day, expiryDate.month, expiryDate.year)
			Rayfield:Notify({
				Title = "üîë Loading Menu Utama",
				Content = "GUI utama akan muncul...",
				Duration = 2
			})

			loadMainGUI()
		else
			if info == "expired" then
				Rayfield:Notify({
					Title = "‚è∞ Key Kadaluarsa",
					Content = "Key ini sudah tidak berlaku lagi.",
					Duration = 4
				})
			else
				Rayfield:Notify({
					Title = "‚ùå Key Tidak Valid",
					Content = "Periksa kembali key kamu.",
					Duration = 3
				})
			end
		end
	end
})

-------------------------------------------------
-- ‚úàÔ∏è MAIN SCRIPT (Fly + Teleport)
-------------------------------------------------
function loadMainGUI()
	if not keyVerified then return end

	local waypoints = {
		{name = "Mount Cicok", pos = Vector3.new(-161.89, 1598.15, -2141.80)},
		{name = "Mount Tatansutarma", pos = Vector3.new(-2234.73, 565.96, 1402.06)}
	}

	local flying = false
	local flySpeed = 60
	local bodyGyro, bodyVel

	local function getHRP()
		local c = player.Character
		if not c then return nil end
		return c:FindFirstChild("HumanoidRootPart")
	end

	local function teleportTo(pos)
		local hrp = getHRP()
		if hrp then
			hrp.CFrame = CFrame.new(pos + Vector3.new(0, 3, 0))
		end
	end

	local function startFly()
		local hrp = getHRP()
		if not hrp then return end
		flying = true

		bodyGyro = Instance.new("BodyGyro")
		bodyGyro.P = 9e4
		bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
		bodyGyro.CFrame = hrp.CFrame
		bodyGyro.Parent = hrp

		bodyVel = Instance.new("BodyVelocity")
		bodyVel.Velocity = Vector3.zero
		bodyVel.MaxForce = Vector3.new(9e9, 9e9, 9e9)
		bodyVel.Parent = hrp

		local cam = workspace.CurrentCamera

		RunService.RenderStepped:Connect(function()
			if flying and hrp and bodyGyro and bodyVel then
				bodyGyro.CFrame = CFrame.new(hrp.Position, hrp.Position + cam.CFrame.LookVector)
				local moveDir = Vector3.zero

				if UserInputService:IsKeyDown(Enum.KeyCode.W) then moveDir += cam.CFrame.LookVector end
				if UserInputService:IsKeyDown(Enum.KeyCode.S) then moveDir -= cam.CFrame.LookVector end
				if UserInputService:IsKeyDown(Enum.KeyCode.A) then moveDir -= cam.CFrame.RightVector end
				if UserInputService:IsKeyDown(Enum.KeyCode.D) then moveDir += cam.CFrame.RightVector end
				if UserInputService:IsKeyDown(Enum.KeyCode.Space) then moveDir += Vector3.new(0, 1, 0) end
				if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then moveDir -= Vector3.new(0, 1, 0) end

				local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
				if humanoid and humanoid.MoveDirection.Magnitude > 0 then
					local camCF = cam.CFrame
					local joyDir = humanoid.MoveDirection
					moveDir = (camCF.RightVector * joyDir.X) + (camCF.LookVector * joyDir.Z)
				end

				if moveDir.Magnitude > 0 then
					bodyVel.Velocity = moveDir.Unit * flySpeed
				else
					bodyVel.Velocity = Vector3.zero
				end
			end
		end)
	end

	local function stopFly()
		flying = false
		if bodyGyro then bodyGyro:Destroy() bodyGyro = nil end
		if bodyVel then bodyVel:Destroy() bodyVel = nil end
	end

	-- ü™ü GUI
	local Window = Rayfield:CreateWindow({
		Name = "RAFEEYL - Auto Teleport",
		LoadingTitle = "RAFEEYL Menu",
		LoadingSubtitle = "Key Aktif hingga " .. string.format("%02d/%02d/%04d", expiryDate.day, expiryDate.month, expiryDate.year)
	})

	local Tab = Window:CreateTab("Teleport", 4483362458)

	Tab:CreateButton({
		Name = "üïäÔ∏è Fly (ON/OFF)",
		Callback = function()
			if flying then
				stopFly()
			else
				startFly()
			end
		end
	})

	Tab:CreateSlider({
		Name = "‚ö° Kecepatan Fly",
		Range = {10, 200},
		Increment = 5,
		Suffix = "Speed",
		CurrentValue = flySpeed,
		Callback = function(v)
			flySpeed = v
		end
	})

	for _, wp in ipairs(waypoints) do
		Tab:CreateButton({
			Name = "üåç Teleport ke: " .. wp.name,
			Callback = function()
				teleportTo(wp.pos)
			end
		end)
	end
end
