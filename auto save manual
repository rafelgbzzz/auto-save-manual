-- RAFEEYL Auto Teleport (Waypoint Permanen + Save + Copy + Auto Respawn + Fly Universal)

local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- üß≠ Daftar Waypoint (isi posisi kamu di sini)
local waypoints = {
    {name = "Mount Cicok", pos = Vector3.new(-161.89, 1598.15, -2141.80)},
    {name = "Mount Tatansutarman", pos = Vector3.new(-2234.73, 565.96, 1402.06)}
}

-- üîß Variabel utama
local running = false
local autoRespawn = true
local delaySeconds = 5
local loopCoroutine
local respawnLoop

-- ‚úàÔ∏è Fly Settings
local flying = false
local flySpeed = 60
local bodyGyro, bodyVel

-- üß© Helper: Ambil HRP
local function getHRP()
    local c = player.Character
    if not c then return nil end
    return c:FindFirstChild("HumanoidRootPart")
end

-- üìç Teleport ke posisi
local function teleportTo(pos)
    local hrp = getHRP()
    if hrp then
        hrp.CFrame = CFrame.new(pos + Vector3.new(0, 3, 0))
    end
end

-- üîÅ Auto Respawn Loop
local function startAutoRespawn()
    if respawnLoop then return end
    respawnLoop = coroutine.create(function()
        while autoRespawn do
            player:LoadCharacter()
            Rayfield:Notify({
                Title = "Auto Respawn",
                Content = "Respawn otomatis dilakukan.",
                Duration = 1.5
            })
            task.wait(delaySeconds)
        end
    end)
    coroutine.resume(respawnLoop)
end

local function stopAutoRespawn()
    autoRespawn = false
    respawnLoop = nil
end

-- üöÄ Fly functions (Universal, Fix Joystick Direction)
local function startFly()
    local hrp = getHRP()
    if not hrp then return end
    flying = true

    bodyGyro = Instance.new("BodyGyro")
    bodyGyro.P = 9e4
    bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
    bodyGyro.CFrame = hrp.CFrame
    bodyGyro.Parent = hrp

    bodyVel = Instance.new("BodyVelocity")
    bodyVel.Velocity = Vector3.zero
    bodyVel.MaxForce = Vector3.new(9e9, 9e9, 9e9)
    bodyVel.Parent = hrp

    Rayfield:Notify({
        Title = "üïäÔ∏è Fly Aktif",
        Content = "PC: W A S D / Space / Shift | HP: Joystick arah kamera",
        Duration = 4
    })

    local cam = workspace.CurrentCamera

    RunService.RenderStepped:Connect(function()
        if flying and hrp and bodyGyro and bodyVel then
            -- Rotasi tubuh ikut arah kamera
            bodyGyro.CFrame = CFrame.new(hrp.Position, hrp.Position + cam.CFrame.LookVector)

            local moveDir = Vector3.zero

            -- üíª PC Control
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                moveDir += cam.CFrame.LookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                moveDir -= cam.CFrame.LookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                moveDir -= cam.CFrame.RightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                moveDir += cam.CFrame.RightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                moveDir += Vector3.new(0, 1, 0)
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
                moveDir -= Vector3.new(0, 1, 0)
            end

            -- üì± HP Control (Joystick arah kamera)
            local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
            if humanoid and humanoid.MoveDirection.Magnitude > 0 then
                local camCF = cam.CFrame
                local joyDir = humanoid.MoveDirection
                moveDir = (camCF.RightVector * joyDir.X) + (camCF.LookVector * joyDir.Z)
            end

            -- Terapkan kecepatan (jika bergerak)
            if moveDir.Magnitude > 0 then
                bodyVel.Velocity = moveDir.Unit * flySpeed
            else
                bodyVel.Velocity = Vector3.zero
            end
        else
            if bodyGyro then bodyGyro:Destroy() bodyGyro = nil end
            if bodyVel then bodyVel:Destroy() bodyVel = nil end
        end
    end)
end

local function stopFly()
    flying = false
    if bodyGyro then bodyGyro:Destroy() bodyGyro = nil end
    if bodyVel then bodyVel:Destroy() bodyVel = nil end
    Rayfield:Notify({
        Title = "üïäÔ∏è Fly Nonaktif",
        Content = "Kamu telah menonaktifkan mode terbang.",
        Duration = 2
    })
end

-- üîÅ Auto Teleport Loop
local function startLoop()
    if running or #waypoints == 0 then
        warn("[RAFEEYL] Tidak ada waypoint permanen!")
        return
    end
    running = true

    if autoRespawn then
        startAutoRespawn()
    end

    loopCoroutine = coroutine.create(function()
        local idx = 1
        while running do
            local wp = waypoints[idx]
            teleportTo(wp.pos)
            Rayfield:Notify({
                Title = "Teleporting...",
                Content = "Menuju lokasi: " .. wp.name,
                Duration = 2
            })
            idx += 1
            if idx > #waypoints then idx = 1 end
            task.wait(delaySeconds)
        end
    end)
    coroutine.resume(loopCoroutine)
end

-- ü™ü GUI SETUP
local Window = Rayfield:CreateWindow({
    Name = "RAFEEYL - Auto Teleport",
    LoadingTitle = "RAFEEYL",
    LoadingSubtitle = "Permanent Summit Universal"
})

local Tab = Window:CreateTab("Teleport", 4483362458)

-- üíæ Save Posisi (Copy ke Clipboard)
Tab:CreateButton({
    Name = "üíæ Save Posisi (Copy ke Clipboard)",
    Callback = function()
        local character = player.Character or player.CharacterAdded:Wait()
        local hrp = character:WaitForChild("HumanoidRootPart", 2)
        if not hrp then
            Rayfield:Notify({
                Title = "Gagal",
                Content = "Tidak dapat menemukan posisi karakter!",
                Duration = 2
            })
            return
        end

        local pos = hrp.Position
        local text = string.format("Vector3.new(%.2f, %.2f, %.2f)", pos.X, pos.Y, pos.Z)
        if setclipboard then
            setclipboard(text)
            Rayfield:Notify({
                Title = "Posisi Disalin!",
                Content = "Koordinat berhasil disalin ke clipboard:\n" .. text,
                Duration = 4
            })
        else
            Rayfield:Notify({
                Title = "Clipboard Tidak Didukung",
                Content = "Executor kamu tidak mendukung setclipboard!",
                Duration = 3
            })
        end
    end
})

-- ‚ñ∂Ô∏è Start Auto Teleport
Tab:CreateButton({
    Name = "‚ñ∂Ô∏è Start Auto Teleport",
    Callback = function()
        running = true
        autoRespawn = true
        startLoop()
        Rayfield:Notify({
            Title = "Started",
            Content = "Auto Teleport + Auto Respawn aktif.",
            Duration = 2
        })
    end
})

-- ‚èπ Stop Semua
Tab:CreateButton({
    Name = "‚èπ Stop Semua",
    Callback = function()
        running = false
        stopAutoRespawn()
        stopFly()
        Rayfield:Notify({
            Title = "Stopped",
            Content = "Auto Teleport, Respawn, dan Fly dihentikan.",
            Duration = 2
        })
    end
})

-- üïäÔ∏è Fly (ON/OFF)
Tab:CreateButton({
    Name = "üïäÔ∏è Fly (ON/OFF)",
    Callback = function()
        if flying then
            stopFly()
        else
            startFly()
        end
    end
})

-- ‚ö° Slider Kecepatan Fly
Tab:CreateSlider({
    Name = "‚ö° Kecepatan Fly",
    Range = {10, 200},
    Increment = 5,
    Suffix = "Speed",
    CurrentValue = flySpeed,
    Callback = function(v)
        flySpeed = v
        Rayfield:Notify({
            Title = "Kecepatan Fly",
            Content = "Kecepatan diubah menjadi: " .. tostring(v),
            Duration = 2
        })
    end
})

-- üåç Teleport Manual
for _, wp in ipairs(waypoints) do
    Tab:CreateButton({
        Name = "üåç Teleport ke: " .. wp.name,
        Callback = function()
            teleportTo(wp.pos)
            Rayfield:Notify({
                Title = "Teleport Manual",
                Content = "Berhasil teleport ke: " .. wp.name,
                Duration = 2
            })
        end
    })
end
