-- ZeroKage„Çº„É≠ÂΩ±

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- Load Rayfield GUI aman
local ok, Rayfield = pcall(function()
    return loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
end)
if not ok or not Rayfield then
    warn("Gagal load Rayfield GUI. Periksa koneksi atau URL Rayfield.")
    return
end

-- Key system setup
local localKeys = {
    { key = "rafelll", expiry = "2025-11-25" },
}

local function parseExpiry(str)
    local y, m, d = str:match("^(%d+)%-(%d+)%-(%d+)$")
    if not y then return nil end
    return { year = tonumber(y), month = tonumber(m), day = tonumber(d) }
end

local function getLocalDate()
    local t = os.date("*t")
    return { year = t.year, month = t.month, day = t.day }
end

local function isExpired(expiry, now)
    if now.year > expiry.year then return true end
    if now.year < expiry.year then return false end
    if now.month > expiry.month then return true end
    if now.month < expiry.month then return false end
    if now.day > expiry.day then return true end
    return false
end

local function validateKey(inputKey, keyList, now)
    for _, entry in ipairs(keyList) do
        if entry.key == inputKey then
            local expiry = parseExpiry(entry.expiry)
            if not expiry then return false, "invalid_expiry" end
            if isExpired(expiry, now) then return false, "expired" end
            return true, expiry
        end
    end
    return false, "invalid"
end

local keyVerified = false
local expiryDate = nil
local KeyWindow = nil

local function showKeyWindow()
    KeyWindow = Rayfield:CreateWindow({
        Name = "üï∏Ô∏è ZeroKage„Çº„É≠ÂΩ±",
        LoadingTitle = "ZeroKage Security",
        LoadingSubtitle = "Verifikasi Key Access"
    })

    local Tab = KeyWindow:CreateTab("Verifikasi", 4483362458)

    Tab:CreateInput({
        Name = "Masukkan Key",
        PlaceholderText = "Contoh: abcd",
        RemoveTextAfterFocusLost = false,
        Callback = function(input)
            Rayfield:Notify({
                Title = "üîç Memeriksa Key...",
                Content = "Harap tunggu...",
                Duration = 1.5
            })

            local now = getLocalDate()
            local valid, info = validateKey(input, localKeys, now)
            if valid then
                keyVerified = true
                expiryDate = info
                Rayfield:Notify({
                    Title = "‚úÖ Key Diterima",
                    Content = "Akses disetujui hingga " ..
                        string.format("%02d/%02d/%04d", info.day, info.month, info.year),
                    Duration = 4
                })

                KeyWindow.Visible = false
                task.wait(0.2)
                loadMainGUI()
            else
                if info == "expired" then
                    Rayfield:Notify({
                        Title = "‚è∞ Key Kadaluarsa",
                        Content = "Key sudah kadaluarsa.",
                        Duration = 4
                    })
                elseif info == "invalid_expiry" then
                    Rayfield:Notify({
                        Title = "‚ùå Format Expiry Salah",
                        Content = "Periksa format expiry pada key.",
                        Duration = 4
                    })
                else
                    Rayfield:Notify({
                        Title = "‚ùå Key Tidak Valid",
                        Content = "Periksa kembali key kamu.",
                        Duration = 3
                    })
                end
            end
        end
    })
end

-- Waypoints dengan checkpoint
local waypoints = {
    {
        name = "Mount Atin",
        checkpoints = {
            {name = "cp1", pos = Vector3.new(100, 50, 100)},
            {name = "cp2", pos = Vector3.new(110, 55, 105)},
            {name = "cp3", pos = Vector3.new(120, 60, 110)},
            {name = "cp4", pos = Vector3.new(130, 65, 115)},
        }
    },
    {
        name = "Mount Cicok",
        checkpoints = {
            {name = "default", pos = Vector3.new(-161.89, 1598.15, -2141.80)}
        }
    },
    {
        name = "Mount Tatansutarma",
        checkpoints = {
            {name = "default", pos = Vector3.new(-2234.73, 565.96, 1402.06)}
        }
    }
}

local flying = false
local flySpeed = 60
local walkSpeed = 16
local jumpPower = 50
local antiAFKEnabled = false
local bodyGyro, bodyVel, flyConnection, antiAFKConnection

local function getHRP()
    local c = player.Character
    if not c then return nil end
    return c:FindFirstChild("HumanoidRootPart")
end

local function teleportToCheckpoint(mountName, checkpointName)
    for _, mount in pairs(waypoints) do
        if mount.name == mountName then
            for _, cp in pairs(mount.checkpoints) do
                if cp.name == checkpointName then
                    local hrp = getHRP()
                    if hrp then
                        hrp.CFrame = CFrame.new(cp.pos + Vector3.new(0, 3, 0))
                        Rayfield:Notify({
                            Title = "‚úàÔ∏è Teleport Berhasil",
                            Content = "Ke " .. mountName .. " - " .. checkpointName,
                            Duration = 3
                        })
                        return
                    else
                        Rayfield:Notify({
                            Title = "‚ö†Ô∏è Gagal Teleport",
                            Content = "Character belum siap.",
                            Duration = 2
                        })
                        return
                    end
                end
            end
        end
    end
    Rayfield:Notify({
        Title = "‚ùå Error",
        Content = "Mount atau checkpoint tidak ditemukan.",
        Duration = 3
    })
end

local function startFly()
    local hrp = getHRP()
    if not hrp then
        Rayfield:Notify({
            Title = "‚ö†Ô∏è Gagal Fly",
            Content = "Character belum siap.",
            Duration = 2
        })
        return
    end
    flying = true
    bodyGyro = Instance.new("BodyGyro")
    bodyGyro.P = 9e4
    bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
    local cam = workspace.CurrentCamera
    local lookVector = cam.CFrame.LookVector
    lookVector = Vector3.new(lookVector.X, 0, lookVector.Z).Unit
    bodyGyro.CFrame = CFrame.new(hrp.Position, hrp.Position + lookVector)
    bodyGyro.Parent = hrp

    bodyVel = Instance.new("BodyVelocity")
    bodyVel.Velocity = Vector3.zero
    bodyVel.MaxForce = Vector3.new(9e9, 9e9, 9e9)
    bodyVel.Parent = hrp

    flyConnection = RunService.RenderStepped:Connect(function()
        if not flying or not hrp or not hrp.Parent then return end
        local cam = workspace.CurrentCamera
        local lookVector = cam.CFrame.LookVector
        lookVector = Vector3.new(lookVector.X, 0, lookVector.Z).Unit
        bodyGyro.CFrame = CFrame.new(hrp.Position, hrp.Position + lookVector)

        local moveDir = Vector3.zero
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then moveDir += lookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then moveDir -= lookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then moveDir -= cam.CFrame.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then moveDir += cam.CFrame.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.Space) then moveDir += Vector3.new(0, 1, 0) end
        if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then moveDir -= Vector3.new(0, 1, 0) end

        local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
        if humanoid and humanoid.MoveDirection.Magnitude > 0 then
            moveDir = Vector3.new(humanoid.MoveDirection.X, 0, humanoid.MoveDirection.Z)
        end

        if moveDir.Magnitude > 0 then
            bodyVel.Velocity = moveDir.Unit * flySpeed
        else
            bodyVel.Velocity = Vector3.zero
        end
    end)
end

local function stopFly()
    flying = false
    if bodyGyro then bodyGyro:Destroy() bodyGyro = nil end
    if bodyVel then bodyVel:Destroy() bodyVel = nil end
    if flyConnection then flyConnection:Disconnect() flyConnection = nil end
end

function loadMainGUI()
    if not keyVerified then return end

    local Window = Rayfield:CreateWindow({
        Name = "ZeroKage„Çº„É≠ÂΩ±",
        LoadingTitle = "ZeroKage Menu",
        LoadingSubtitle = "Key Aktif hingga " ..
            string.format("%02d/%02d/%04d", expiryDate.day, expiryDate.month, expiryDate.year)
    })

    local TabTeleport = Window:CreateTab("Teleport", 4483362458)

    for _, mount in ipairs(waypoints) do
        if #mount.checkpoints > 1 then
            if mount.name == "Mount Atin" then
                local cpNames = {}
                for _, cp in ipairs(mount.checkpoints) do
                    table.insert(cpNames, cp.name)
                end
                TabTeleport:CreateDropdown({
                    Name = "üåç Teleport ke " .. mount.name,
                    Options = cpNames,
                    CurrentOption = cpNames[1],
                    Callback = function(selectedCheckpoint)
                        teleportToCheckpoint(mount.name, selectedCheckpoint)
                    end
                })
            else
                TabTeleport:CreateButton({
                    Name = "üåç Teleport ke: " .. mount.name,
                    Callback = function()
                        teleportToCheckpoint(mount.name, mount.checkpoints[1].name)
                    end
                })
            end
        else
            TabTeleport:CreateButton({
                Name = "üåç Teleport ke: " .. mount.name,
                Callback = function()
                    teleportToCheckpoint(mount.name, mount.checkpoints[1].name)
                end
            })
        end
    end

    local TabFitur = Window:CreateTab("Fitur", 4483362458)

    TabFitur:CreateButton({
        Name = "üíæ Copy Koordinat Sekarang",
        Callback = function()
            local hrp = getHRP()
            if not hrp then
                Rayfield:Notify({
                    Title = "‚ö†Ô∏è Gagal",
                    Content = "Character belum siap.",
                    Duration = 2
                })
                return
            end
            local pos = hrp.Position
            local koordinat = string.format("Vector3.new(%.2f, %.2f, %.2f)", pos.X, pos.Y, pos.Z)
            setclipboard(koordinat)
            Rayfield:Notify({
                Title = "‚úÖ Koordinat Disalin",
                Content = koordinat,
                Duration = 4
            })
        end
    })

    TabFitur:CreateToggle({
        Name = "üõ°Ô∏è Anti AFK (ON/OFF)",
        CurrentValue = false,
        Callback = function(value)
            antiAFKEnabled = value
            if value then
                if antiAFKConnection then antiAFKConnection:Disconnect() end
                antiAFKConnection = player.Idled:Connect(function()
                    local VirtualUser = game:service('VirtualUser')
                    VirtualUser:CaptureController()
                    VirtualUser:ClickButton2(Vector2.new())
                end)
                Rayfield:Notify({
                    Title = "üõ°Ô∏è Anti AFK Aktif",
                    Content = "Kamu aman dari kick AFK!",
                    Duration = 4
                })
            else
                if antiAFKConnection then
                    antiAFKConnection:Disconnect()
                    antiAFKConnection = nil
                end
                Rayfield:Notify({
                    Title = "üí§ Anti AFK Nonaktif",
                    Content = "AFK protection dimatikan.",
                    Duration = 3
                })
            end
        end
    })

    local TabSpeed = Window:CreateTab("Kecepatan", 4483362458)

    TabSpeed:CreateToggle({
        Name = "üïäÔ∏è Mode Fly",
        CurrentValue = false,
        Callback = function(state)
            if state then
                startFly()
                Rayfield:Notify({
                    Title = "‚úàÔ∏è Fly Aktif",
                    Content = "Gunakan W A S D / Joystick untuk bergerak.",
                    Duration = 3
                })
            else
                stopFly()
                Rayfield:Notify({
                    Title = "üõë Fly Dimatikan",
                    Content = "Mode fly telah berhenti.",
                    Duration = 2
                })
            end
        end,
    })

    TabSpeed:CreateSlider({
        Name = "‚ö° Kecepatan Fly",
        Range = {10, 200},
        Increment = 5,
        Suffix = "Speed",
        CurrentValue = flySpeed,
        Callback = function(v) flySpeed = v end
    })

    local SpeedSlider = TabSpeed:CreateSlider({
        Name = "üèÉ Kecepatan Lari",
        Range = {16, 200},
        Increment = 1,
        Suffix = "Speed",
        CurrentValue = walkSpeed,
        Callback = function(value)
            local char = player.Character
            local hum = char and char:FindFirstChildOfClass("Humanoid")
            if hum then
                hum.WalkSpeed = value
                walkSpeed = value
            end
        end,
    })

    local JumpSlider = TabSpeed:CreateSlider({
        Name = "ü¶ò Kekuatan Lompatan",
        Range = {50, 500},
        Increment = 10,
        Suffix = "Power",
        CurrentValue = jumpPower,
        Callback = function(value)
            local char = player.Character
            local hum = char and char:FindFirstChildOfClass("Humanoid")
            if hum then
                hum.UseJumpPower = true
                hum.JumpPower = value
                jumpPower = value
            end
        end,
    })

    TabSpeed:CreateButton({
        Name = "‚Ü©Ô∏è Reset Kecepatan & Lompatan (Normal)",
        Callback = function()
            local char = player.Character
            local hum = char and char:FindFirstChildOfClass("Humanoid")
            if hum then
                hum.WalkSpeed = 16
                hum.JumpPower = 50
            end
            SpeedSlider:Set(16)
            JumpSlider:Set(50)
            Rayfield:Notify({
                Title = "Reset Berhasil",
                Content = "WalkSpeed & JumpPower dikembalikan ke normal.",
                Duration = 3
            })
        end,
    })

    player.CharacterAdded:Connect(function(char)
        local hum = char:WaitForChild("Humanoid")
        hum.WalkSpeed = walkSpeed
        hum.JumpPower = jumpPower
    end)
end

showKeyWindow()
