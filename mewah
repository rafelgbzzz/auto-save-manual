-- ZeroKage with Nexus UI

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- Load Nexus UI Library
local NexusUI
do
    local success, result = pcall(function()
        return loadstring(game:HttpGet("https://raw.githubusercontent.com/NexusDevelopment/Nexus-UI-Library/main/Source.lua"))()
    end)
    if not success or not result then
        warn("Gagal memuat Nexus UI.")
        return
    end
    NexusUI = result
end

-- Key Verification Data
local localKeys = {
    { key = "rafelll", expiry = "2025-11-25" },
}

local function parseExpiry(str)
    local y, m, d = str:match("^(%d+)%-(%d+)%-(%d+)$")
    if not y then return nil end
    return { year = tonumber(y), month = tonumber(m), day = tonumber(d) }
end

local function getLocalDate()
    local t = os.date("*t")
    return { year = t.year, month = t.month, day = t.day }
end

local function isExpired(expiry, now)
    if now.year > expiry.year then return true end
    if now.year < expiry.year then return false end
    if now.month > expiry.month then return true end
    if now.month < expiry.month then return false end
    if now.day > expiry.day then return true end
    return false
end

local function validateKey(inputKey, keyList, now)
    for _, entry in ipairs(keyList) do
        if entry.key == inputKey then
            local expiry = parseExpiry(entry.expiry)
            if not expiry then return false, "invalid_expiry" end
            if isExpired(expiry, now) then return false, "expired" end
            return true, expiry
        end
    end
    return false, "invalid"
end

local keyVerified = false
local expiryDate = nil

-- Create Nexus Window for Key verification
local keyWindow = NexusUI:CreateWindow({
    Name = "🕸️ ZeroKage - Verifikasi Key",
    Size = Vector2.new(500, 300),
    Position = UDim2.new(0.5, 0, 0.5, 0),
    AnchorPoint = Vector2.new(0.5, 0.5),
})

local keyInputLabel = keyWindow:AddLabel("Masukkan Key:")
local keyInputBox = keyWindow:AddTextbox({
    ClearTextOnFocus = false,
    PlaceholderText = "Contoh: abcd",
})

local notificationLabel = keyWindow:AddLabel("")

keyInputBox.FocusLost:Connect(function(enterPressed)
    if not enterPressed then return end
    local input = keyInputBox.Text
    notificationLabel.Text = "🔍 Memeriksa Key..."
    local now = getLocalDate()
    local valid, info = validateKey(input, localKeys, now)
    if valid then
        keyVerified = true
        expiryDate = info
        notificationLabel.Text = "✅ Key diterima! Akses sampai " .. string.format("%02d/%02d/%04d", info.day, info.month, info.year)
        task.wait(1)
        keyWindow:Destroy()
        loadMainGUI()
    else
        if info == "expired" then
            notificationLabel.Text = "⏰ Key sudah kadaluarsa."
        elseif info == "invalid_expiry" then
            notificationLabel.Text = "❌ Format expiry salah."
        else
            notificationLabel.Text = "❌ Key tidak valid. Coba lagi."
        end
    end
end)

-- Fungsi utama GUI setelah key verified
function loadMainGUI()
    if not keyVerified then return end

    local waypoints = {
        {name = "Mount Cicok", pos = Vector3.new(-161.89, 1598.15, -2141.80)},
        {name = "Mount Tatansutarma", pos = Vector3.new(-2234.73, 565.96, 1402.06)}
    }

    local flying = false
    local flySpeed = 60
    local walkSpeed = 16
    local jumpPower = 50
    local antiAFKEnabled = false
    local bodyGyro, bodyVel
    local flyConnection
    local antiAFKConnection

    local function getHRP()
        local c = player.Character
        if not c then return nil end
        return c:FindFirstChild("HumanoidRootPart")
    end

    local function teleportTo(pos)
        local hrp = getHRP()
        if hrp then
            hrp.CFrame = CFrame.new(pos + Vector3.new(0, 3, 0))
        else
            keyWindow:AddLabel("⚠️ Gagal teleport. Character belum siap.")
        end
    end

    local function startFly()
        local hrp = getHRP()
        if not hrp then
            keyWindow:AddLabel("⚠️ Gagal fly. Character belum siap.")
            return
        end

        flying = true

        bodyGyro = Instance.new("BodyGyro")
        bodyGyro.P = 9e4
        bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
        
        local cam = workspace.CurrentCamera
        local lookVector = cam.CFrame.LookVector
        lookVector = Vector3.new(lookVector.X, 0, lookVector.Z).Unit
        bodyGyro.CFrame = CFrame.new(hrp.Position, hrp.Position + lookVector)
        bodyGyro.Parent = hrp

        bodyVel = Instance.new("BodyVelocity")
        bodyVel.Velocity = Vector3.zero
        bodyVel.MaxForce = Vector3.new(9e9, 9e9, 9e9)
        bodyVel.Parent = hrp

        flyConnection = RunService.RenderStepped:Connect(function()
            if not flying or not hrp or not hrp.Parent then return end

            local cam = workspace.CurrentCamera
            local lookVector = cam.CFrame.LookVector
            lookVector = Vector3.new(lookVector.X, 0, lookVector.Z).Unit
            bodyGyro.CFrame = CFrame.new(hrp.Position, hrp.Position + lookVector)

            local moveDir = Vector3.zero

            if UserInputService:IsKeyDown(Enum.KeyCode.W) then moveDir += lookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then moveDir -= lookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then moveDir -= cam.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then moveDir += cam.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then moveDir += Vector3.new(0, 1, 0) end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then moveDir -= Vector3.new(0, 1, 0) end

            local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
            if humanoid and humanoid.MoveDirection.Magnitude > 0 then
                moveDir = Vector3.new(humanoid.MoveDirection.X, 0, humanoid.MoveDirection.Z)
            end

            if moveDir.Magnitude > 0 then
                bodyVel.Velocity = moveDir.Unit * flySpeed
            else
                bodyVel.Velocity = Vector3.zero
            end
        end)
    end

    local function stopFly()
        flying = false
        if bodyGyro then bodyGyro:Destroy() bodyGyro = nil end
        if bodyVel then bodyVel:Destroy() bodyVel = nil end
        if flyConnection then flyConnection:Disconnect() flyConnection = nil end
    end

    -- Buat Window utama Nexus UI
    local MainWindow = NexusUI:CreateWindow({
        Name = "ZeroKage",
        Size = Vector2.new(600, 400),
        Position = UDim2.new(0.5,0,0.5,0),
        AnchorPoint = Vector2.new(0.5,0.5)
    })

    -- Tab Teleport
    local TabTeleport = MainWindow:AddTab("Teleport")
    for _, wp in ipairs(waypoints) do
        TabTeleport:AddButton(wp.name, function()
            teleportTo(wp.pos)
        end)
    end

    -- Tab Fitur
    local TabFitur = MainWindow:AddTab("Fitur")
    TabFitur:AddButton("Copy Koordinat Sekarang", function()
        local hrp = getHRP()
        if not hrp then
            return
        end
        local pos = hrp.Position
        local koordinat = string.format("Vector3.new(%.2f, %.2f, %.2f)", pos.X, pos.Y, pos.Z)
        setclipboard(koordinat)
        -- Tampilkan notif sederhana (bisa ditambahkan)
    end)
    TabFitur:AddToggle("Anti AFK", false, function(value)
        antiAFKEnabled = value
        if value then
            if antiAFKConnection then antiAFKConnection:Disconnect() end
            antiAFKConnection = player.Idled:Connect(function()
                local VirtualUser = game:GetService('VirtualUser')
                VirtualUser:CaptureController()
                VirtualUser:ClickButton2(Vector2.new())
            end)
        else
            if antiAFKConnection then
                antiAFKConnection:Disconnect()
                antiAFKConnection = nil
            end
        end
    end)

    -- Tab Kecepatan
    local TabSpeed = MainWindow:AddTab("Kecepatan")
    TabSpeed:AddToggle("Mode Fly", false, function(state)
        if state then
            startFly()
        else
            stopFly()
        end
    end)
    TabSpeed:AddSlider("Kecepatan Fly", flySpeed, 10, 200, 1, function(value)
        flySpeed = value
    end)
    TabSpeed:AddSlider("Kecepatan Lari", walkSpeed, 16, 200, 1, function(value)
        walkSpeed = value
        local char = player.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.WalkSpeed = value
        end
    end)
    TabSpeed:AddSlider("Kekuatan Lompatan", jumpPower, 50, 500, 1, function(value)
        jumpPower = value
        local char = player.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.UseJumpPower = true
            hum.JumpPower = value
        end
    end)
    TabSpeed:AddButton("Reset Kecepatan", function()
        local char = player.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.WalkSpeed = 16
            hum.JumpPower = 50
        end
        flySpeed = 60
        walkSpeed = 16
        jumpPower = 50
    end)

    -- Jaga speed & jump saat respawn
    player.CharacterAdded:Connect(function(char)
        local hum = char:WaitForChild("Humanoid")
        hum.WalkSpeed = walkSpeed
        hum.JumpPower = jumpPower
    end)
end

-- Jalankan Key Window pertama kali
