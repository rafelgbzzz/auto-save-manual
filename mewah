local Players = game:GetService("Players")
local player = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- Load Vape UI
local ok, Vape = pcall(function()
    return loadstring(game:HttpGet("https://path/to/vapeui/main.lua"))()
end)
if not ok or not Vape then
    warn("Gagal load Vape UI.")
    return
end

-- Key Verification System
local localKeys = {
    { key = "rafelll", expiry = "2025-11-25" },
}

-- Functions for key expiry check (sama seperti sebelumnya)
local function parseExpiry(str)
    local y, m, d = str:match("^(%d+)%-(%d+)%-(%d+)$")
    if not y then return nil end
    return { year = tonumber(y), month = tonumber(m), day = tonumber(d) }
end

local function getLocalDate()
    local t = os.date("*t")
    return { year = t.year, month = t.month, day = t.day }
end

local function isExpired(expiry, now)
    if now.year > expiry.year then return true end
    if now.year < expiry.year then return false end
    if now.month > expiry.month then return true end
    if now.month < expiry.month then return false end
    if now.day > expiry.day then return true end
    return false
end

local function validateKey(inputKey, keyList, now)
    for _, entry in ipairs(keyList) do
        if entry.key == inputKey then
            local expiry = parseExpiry(entry.expiry)
            if not expiry then return false, "invalid_expiry" end
            if isExpired(expiry, now) then return false, "expired" end
            return true, expiry
        end
    end
    return false, "invalid"
end

local keyVerified = false
local expiryDate = nil

-- Show Key Verification Window with Vape UI
local KeyWindow = Vape:CreateWindow("üï∏Ô∏è ZeroKage„Çº„É≠ÂΩ± - Verifikasi Key")
local KeyTab = KeyWindow:CreateTab("Key Entry")

-- Assuming Vape UI supports textbox input, replace Button by Textbox input
KeyTab:Textbox("Masukkan Key:", false, function(input)
    Vape:Notification("üîç Memeriksa Key...", "Harap tunggu...")
    local now = getLocalDate()
    local valid, info = validateKey(input, localKeys, now)
    if valid then
        keyVerified = true
        expiryDate = info
        Vape:Notification("‚úÖ Key Diterima", "Akses hingga " .. string.format("%02d/%02d/%04d", info.day, info.month, info.year))
        KeyWindow:Destroy()
        task.wait(0.2)
        loadMainGUI()
    else
        if info == "expired" then
            Vape:Notification("‚è∞ Key Kadaluarsa", "Key sudah kadaluarsa.")
        elseif info == "invalid_expiry" then
            Vape:Notification("‚ùå Format Expiry Salah", "Periksa format expiry pada key.")
        else
            Vape:Notification("‚ùå Key Tidak Valid", "Periksa kembali key kamu.")
        end
    end
end)

-- Main GUI load function with Vape UI
function loadMainGUI()
    if not keyVerified then return end

    local waypoints = {
        {name = "Mount Cicok", pos = Vector3.new(-161.89, 1598.15, -2141.80)},
        {name = "Mount Tatansutarma", pos = Vector3.new(-2234.73, 565.96, 1402.06)}
    }

    local flying = false
    local flySpeed = 60
    local walkSpeed = 16
    local jumpPower = 50
    local antiAFKEnabled = false
    local bodyGyro, bodyVel
    local flyConnection
    local antiAFKConnection

    local function getHRP()
        local c = player.Character
        if not c then return nil end
        return c:FindFirstChild("HumanoidRootPart")
    end

    local function teleportTo(pos)
        local hrp = getHRP()
        if hrp then
            hrp.CFrame = CFrame.new(pos + Vector3.new(0, 3, 0))
        else
            Vape:Notification("‚ö†Ô∏è Gagal Teleport", "Character belum siap.")
        end
    end

    local function startFly()
        local hrp = getHRP()
        if not hrp then
            Vape:Notification("‚ö†Ô∏è Gagal Fly", "Character belum siap.")
            return
        end

        flying = true

        bodyGyro = Instance.new("BodyGyro")
        bodyGyro.P = 9e4
        bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
        local cam = workspace.CurrentCamera
        local lookVector = cam.CFrame.LookVector
        lookVector = Vector3.new(lookVector.X, 0, lookVector.Z).Unit
        bodyGyro.CFrame = CFrame.new(hrp.Position, hrp.Position + lookVector)
        bodyGyro.Parent = hrp

        bodyVel = Instance.new("BodyVelocity")
        bodyVel.Velocity = Vector3.zero
        bodyVel.MaxForce = Vector3.new(9e9, 9e9, 9e9)
        bodyVel.Parent = hrp

        flyConnection = RunService.RenderStepped:Connect(function()
            if not flying or not hrp or not hrp.Parent then return end

            local cam = workspace.CurrentCamera
            local lookVector = cam.CFrame.LookVector
            lookVector = Vector3.new(lookVector.X, 0, lookVector.Z).Unit
            bodyGyro.CFrame = CFrame.new(hrp.Position, hrp.Position + lookVector)

            local moveDir = Vector3.zero

            if UserInputService:IsKeyDown(Enum.KeyCode.W) then moveDir += lookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then moveDir -= lookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then moveDir -= cam.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then moveDir += cam.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then moveDir += Vector3.new(0, 1, 0) end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then moveDir -= Vector3.new(0, 1, 0) end

            local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
            if humanoid and humanoid.MoveDirection.Magnitude > 0 then
                moveDir = Vector3.new(humanoid.MoveDirection.X, 0, humanoid.MoveDirection.Z)
            end

            if moveDir.Magnitude > 0 then
                bodyVel.Velocity = moveDir.Unit * flySpeed
            else
                bodyVel.Velocity = Vector3.zero
            end
        end)
    end

    local function stopFly()
        flying = false
        if bodyGyro then bodyGyro:Destroy() bodyGyro = nil end
        if bodyVel then bodyVel:Destroy() bodyVel = nil end
        if flyConnection then flyConnection:Disconnect() flyConnection = nil end
    end

    -- Create Main Window Vape UI
    local MainWindow = Vape:CreateWindow("ZeroKage„Çº„É≠ÂΩ±")
    local TabTeleport = MainWindow:CreateTab("Teleport")
    local TabFitur = MainWindow:CreateTab("Fitur")
    local TabSpeed = MainWindow:CreateTab("Kecepatan")

    for _, wp in ipairs(waypoints) do
        TabTeleport:Button("üåç Teleport ke: " .. wp.name, function()
            teleportTo(wp.pos)
        end)
    end

    TabFitur:Button("üíæ Copy Koordinat Sekarang", function()
        local hrp = getHRP()
        if not hrp then
            Vape:Notification("‚ö†Ô∏è Gagal", "Character belum siap.")
            return
        end
        local pos = hrp.Position
        local koordinat = string.format("Vector3.new(%.2f, %.2f, %.2f)", pos.X, pos.Y, pos.Z)
        setclipboard(koordinat)
        Vape:Notification("‚úÖ Koordinat Disalin", koordinat)
    end)

    TabFitur:Toggle("üõ°Ô∏è Anti AFK (ON/OFF)", false, function(value)
        antiAFKEnabled = value
        if value then
            if antiAFKConnection then antiAFKConnection:Disconnect() end
            antiAFKConnection = player.Idled:Connect(function()
                local VirtualUser = game:GetService('VirtualUser')
                VirtualUser:CaptureController()
                VirtualUser:ClickButton2(Vector2.new())
            end)
            Vape:Notification("üõ°Ô∏è Anti AFK Aktif", "Kamu aman dari kick AFK!")
        else
            if antiAFKConnection then
                antiAFKConnection:Disconnect()
                antiAFKConnection = nil
            end
            Vape:Notification("üí§ Anti AFK Nonaktif", "AFK protection dimatikan.")
        end
    end)

    -- Speed Toggles and Sliders in Kecepatan Tab

    local flyToggle = TabSpeed:Toggle("üïäÔ∏è Mode Fly", false, function(state)
        if state then
            startFly()
            Vape:Notification("‚úàÔ∏è Fly Aktif", "Gunakan W A S D / Joystick untuk bergerak.")
        else
            stopFly()
            Vape:Notification("üõë Fly Dimatikan", "Mode fly telah berhenti.")
        end
    end)

    local flySpeedSlider = TabSpeed:Slider("‚ö° Kecepatan Fly", 10, 200, flySpeed, function(value)
        flySpeed = value
    end)

    local runSpeedSlider = TabSpeed:Slider("üèÉ Kecepatan Lari", 16, 200, walkSpeed, function(value)
        local char = player.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.WalkSpeed = value
            walkSpeed = value
        end
    end)

    local jumpPowerSlider = TabSpeed:Slider("ü¶ò Kekuatan Lompatan", 50, 500, jumpPower, function(value)
        local char = player.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.UseJumpPower = true
            hum.JumpPower = value
            jumpPower = value
        end
    end)

    TabSpeed:Button("‚Ü©Ô∏è Reset Kecepatan & Lompatan (Normal)", function()
        local char = player.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.WalkSpeed = 16
            hum.JumpPower = 50
        end
        runSpeedSlider:Set(16)
        jumpPowerSlider:Set(50)
        Vape:Notification("Reset Berhasil", "WalkSpeed & JumpPower dikembalikan ke normal.")
    end)

    player.CharacterAdded:Connect(function(char)
        local hum = char:WaitForChild("Humanoid")
        hum.WalkSpeed = walkSpeed
        hum.JumpPower = jumpPower
    end)
end

showKeyWindow() -- Jalankan dapetin key UI yang sudah dibuat
